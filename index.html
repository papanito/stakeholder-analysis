<html>

<head>
    <title>Stakeholder Analysis</title>
    <script src="https://unpkg.com/vue"></script>
    <!--script src="https://unpkg.com/vue-localstore"></script-->
    <link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>
    <h1 id="title">
        {{ title }}
    </h1>
    <div id="stakeholdergrid">
        <div style="padding: 0px 4px 0px 4px">
            <button @click="addRow">Add row</button>
            <label for="sessionname">Session Name: </label>
            <input type="text" name="sessionname" id="sessionname" disabled
                v-model="sessionname">
        </div>
        <table>
            <thead>
                <tr>
                    <td>Name</td>
                    <td>Description</td>
                    <td>Power</td>
                    <td>Interest</td>
                    <td>Color</td>
                </tr>
            </thead>
            <tbody>
                <tr v-for="stakeholder in stakeholderlist" v-bind:class="stakeholder.color">
                    <td>
                        <div class="tooltip">
                            <input type="text"
                            v-model="stakeholder.name" 
                            title="Stakeholder name"
                            placeholder="stakeholder name" 
                            class="tooltip"
                            v-bind:class="{ error: stakeholder.name == '' }"
                            v-on:change="saveData"> 
                            <span class="tooltiptext" v-show="!stakeholder.name" >stakeholder name is missing</span>
                        </div>
                    </td>
                    <td>
                        <div class="tooltip">
                        <input type="text" 
                            v-model="stakeholder.description" 
                            placeholder="description" 
                            v-bind:class="{ error: stakeholder.description == '' }"
                            v-on:change="saveData">
                            <span class="tooltiptext" v-show="!stakeholder.description" >stakeholder description is missing</span>
                        </div>
                    </td>
                    <td>
                        <div class="tooltip">
                        <select v-model="stakeholder.power"
                            v-bind:class="{ error: stakeholder.power == '' }"
                            v-on:change="saveData">
                            <option disabled value="">power</option>
                            <option>very low</option>
                            <option>low</option>
                            <option>low-med</option>
                            <option>med</option>
                            <option>med-high</option>
                            <option>high</option>
                            <option>very high</option>
                        </select>
                            <span class="tooltiptext" 
                                v-show="!stakeholder.power" 
                            >stakeholders power not specified</span>
                        </div>
                    </td>
                    <td>
                        <div class="tooltip">
                        <select v-model="stakeholder.interest"
                            v-bind:class="{ error: stakeholder.interest == '' }"
                            v-on.change="saveData">
                            <option disabled value="">interest</option>
                            <option>very low</option>
                            <option>low</option>
                            <option>low-med</option>
                            <option>med</option>
                            <option>med-high</option>
                            <option>high</option>
                            <option>very high</option>
                        </select>
                            <span class="tooltiptext" v-show="!stakeholder.interest" >stakeholders interest not specified</span>
                        </div>
                    </td>
                    <td>
                        <div class="tooltip">
                        <select v-model="stakeholder.color"
                            v-bind:class="{ error: stakeholder.color == '' }"
                            v-on:change="saveData">
                            <option disabled value="">color</option>
                            <option>green</option>
                            <option>orange</option>
                            <option>red</option>
                        </select>
                            <span class="tooltiptext" v-show="!stakeholder.color" >color not selected</span>
                        </div>
                    </td>
                    <td>
                    <button @click="removeRow(stakeholder)">Remove</button>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>
    <script>
    let myStakeholderlist = JSON.parse(localStorage.getItem('stakeholderlist'))
    if ( myStakeholderlist == null) {
        myStakeholderlist  = new Array();
    } 

    var app = new Vue({
        el: '#title',
        data: {
            title: 'Welcome to the Stakeholder Analysis App'
        }
    })

    var app2 = new Vue({
        el: '#stakeholdergrid',
        data: {
            stakeholderlist: myStakeholderlist,
            sessionname: "noname"
        },
        methods: {
            addRow: function () {
                this.stakeholderlist.push({
                    id: "",
                    name: "",
                    description: "",
                    power: "",
                    interest: "",
                    color: ""
                });
                this.saveData();
            },
            removeRow: function (stakeholder) {
                var index = this.stakeholderlist.indexOf(stakeholder)
                this.stakeholderlist.splice(index, 1);
                this.saveData();
            },
            saveData: function () {
                localStorage.setItem('stakeholderlist', JSON.stringify(this.stakeholderlist))
            }
        }
    })

    </script>
</body>
</html>